(this["webpackJsonpe-learn"]=this["webpackJsonpe-learn"]||[]).push([[24],{1068:function(e,t,n){e.exports={SlideCustomizationContainer:"LessonForm_SlideCustomizationContainer__1urpL",TextEditor:"LessonForm_TextEditor__YGRGl",FormList:"LessonForm_FormList__rwmsr"}},1361:function(e,t,n){"use strict";n.r(t);var a=n(24),o=n(62),r=n(0),i=n.n(r),l=n(344),s=n(345),c=n(349),d=n(27),u=n(343),m=n(31),f=n(7),v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={slides:[],isValid:!0};e.lessonName&&(e.lessonName||"").trim()||(t.isValid=!1,t.lessonName=f.a.t("lessonForm.errors.required")),Array.from(e.lessons||[]).forEach((function(n){e._id!==n._id&&(n.lessonName||"").toLowerCase().trim()===(e.lessonName||"").toLowerCase().trim()&&(t.isValid=!1,t.lessonName=f.a.t("lessonForm.errors.noDuplicateLessonNames"))}));var n=parseInt((e.course||{}).courseStartDate),a=parseInt((e.course||{}).courseEndDate),o=new Date(e.availableOnDate).getTime();return!(n&&a&&o)||o>n&&o<a||(t.availableOnDate=f.a.t("lessonForm.errors.availableOnDateInCourseDuration"),t.isValid=!1),t.slides=Array.from(e.slides||{}).map((function(n){var a={};return n.slideContent||n.videoContent||(t.isValid=!1,a.slideContent=f.a.t("lessonForm.errors.required")),!n.loadedVideo&&n.videoContent&&(t.isValid=!1,a.videoFile=f.a.t("lessonForm.errors.uploadOrDisable")),n.audioFile instanceof File&&n.audioUpload&&(n.audioFile||{}).size>1e3*e.instructorFileSizeLimit*1e3&&(t.isValid=!1,a.audioFile="".concat(f.a.t("lessonForm.errors.audioCannotExceed")," ").concat(e.instructorFileSizeLimit,"MB")),n.videoFile instanceof File&&n.videoContent&&(n.videoFile||{}).size>1e3*e.instructorFileSizeLimit*1e3&&(t.isValid=!1,a.videoFile="".concat(f.a.t("lessonForm.errors.videoCannotExceed")," ").concat(e.instructorFileSizeLimit,"MB")),a.videoFile||a.audioFile||a.slideContent?a:null})),t},p=n(39),b=n(248),E=n(249),F=n(77),g=n(253),h=n(107),y=n(1068),x=n.n(y),w=n(4),O=n(134),j=n(72),C=n(428),_=n(246),A=n(82),L=n(205),k=n(6),P=n.n(k),S=n(41),R=n(250),T=n(245),D=n(252),N=n(830),V=n(825),I=n(851),z=function(e){var t=e.fields,n=e.meta,a=n.error,o=n.submitFailed,r=e.formValues,s=void 0===r?{}:r,c=e.course,d=e.formErrors,u=e.touchField,m=e.t,f=e.editing,v=e.newLessonId,b=e.changeField,F=e.getAudioRecording,g=e.getAudioSource,y=e.setAudioData,w=e.initiateRecording,O=e.getRecorderFromClick,j=e.getRecordingTimeout;return i.a.createElement("ul",{className:x.a.FormList},(t||[]).map((function(e,n){var a={label:m("lessonForm.fields.videoContent"),checked:!1},o={label:m("lessonForm.fields.audioFromFile"),checked:!1,disabled:!!((d.slides||[])[n]||{}).audioFile},r=f?s._id:v,C="courses/".concat(c._id,"/lessons/").concat(r);return r?i.a.createElement("li",{className:x.a.SlideCustomizationContainer,key:n},i.a.createElement(h.a,{variant:"h6",gutterBottom:!0},"".concat(m("lessonForm.slide")," ").concat(n+1)),i.a.createElement(l.a,{name:"slides.".concat(n,".videoContent"),options:a,component:E.a}),((s.slides||[])[n]||{}).videoContent?i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(l.a,{name:"slides.".concat(n,".videoFile"),onChangeFile:function(e){b("slides.".concat(n,".loadedVideo"),e)},uploadButtonText:m("lessonForm.buttons.selectVideoFile"),index:n,component:D.a,loadedFile:((s.slides||[])[n]||{}).loadedVideo,onClear:function(){b("slides.".concat(n,".loadedVideo"),null),b("slides.".concat(n,".videoFile"),null)},videoFile:!0,mimeTypesAllowed:"video/*,video/x-matroska",extensionsAllowed:["mp4","avi","mov","mkv","webm"]},((s.slides||[])[n]||{}).loadedVideo&&i.a.createElement(N.a,{url:((s.slides||[])[n]||{}).loadedVideo}))):i.a.createElement(p.a,null,i.a.createElement("div",{className:x.a.TextEditor},i.a.createElement(l.a,{name:"slides.".concat(n,".slideContent"),component:R.a,path:C,reduxForm:"lessonForm",field:"slides.".concat(n,".slideContent")})),i.a.createElement(l.a,{name:"slides.".concat(n,".audioUpload"),options:o,component:E.a}),i.a.createElement(p.a,null,((s.slides||[])[n]||{}).audioUpload?i.a.createElement(p.a,null,i.a.createElement("div",{style:{textAlign:"center"},className:x.a.flexPositioningEven},i.a.createElement(l.a,{name:"slides.".concat(n,".audioFile"),index:n,uploadButtonText:m("lessonForm.buttons.selectAudioFile"),onChangeFile:function(e){b("slides.".concat(n,".recordedBlob"),e),u("slides.".concat(n,".audioFile"))},component:D.a,loadedFile:F(s,n),mimeTypesAllowed:"audio/*",extensionsAllowed:["mp3","wav","wma"]}),i.a.createElement(I.b,{onPreview:function(){g(s,n)&&Object(V.b)("slideAudio[".concat(n,"]"))},id:"slideAudio[".concat(n,"]"),audioSource:g(s,n)})),i.a.createElement(I.c,{onClear:function(){return y(null,null,n)}})):i.a.createElement(I.a,{onStart:function(){var e=Object(S.a)(P.a.mark((function e(t){var a;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(V.c)(t,null,n,null,function(){var e=Object(S.a)(P.a.mark((function e(t){var a;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:a=e.sent,y(a.blob,a.file,n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:a=e.t0,w(a.recorder,a.recordingTimeout,n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onStop:function(){var e=Object(S.a)(P.a.mark((function e(t){var a;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(V.d)(t,null,n,j(s,n),O(s,n));case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:a=e.t0,y(a.blob,a.file,n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onPreview:function(){Object(V.b)("slideAudio[".concat(n,"]"))},onClear:function(){return y(null,null,n)},id:"slideAudio[".concat(n,"]"),recordDisabled:F(s,n),audioSource:g(s,n)}))),i.a.createElement("div",{style:{display:"flex",justifyContent:"space-evenly"}},i.a.createElement(T.a,{color:"secondary",onClick:function(){t.remove(n)},disabled:1===(s.slides||[]).length},m("lessonForm.buttons.removeSlide")))):null})),i.a.createElement("li",null,i.a.createElement("div",{style:{display:"flex",justifyContent:"space-evenly"}},i.a.createElement(T.a,{color:"primary",onClick:function(){return t.push({})}},m("lessonForm.buttons.addSlide"))),o&&a&&i.a.createElement("span",null,a)))},B=function(e,t,n,a,o){n||Object(L.a)(e,t,n,a,o,"lessonForm")},M=Object(u.a)({form:"lessonForm",enableReinitialize:!0,destroyOnUnmount:!1,validate:v})((function(e){var t=e.submitting,n=e.formValues,c=void 0===n?{}:n,d=e.editing,u=e.course,m=e.changeField,f=e.formErrors,v=e.touchField,y=e.deleteImg,w=e.initialValues,_=e.addNewLesson,k=e.clearLessonForm,P=e.fetchLesson,S=localStorage.getItem("token"),R=Object(r.useState)([]),T=Object(o.a)(R,2),D=T[0],N=T[1],V=Object(r.useState)(null),I=Object(o.a)(V,2),M=I[0],U=I[1],q=Object(r.useState)(!0),H=Object(o.a)(q,2),G=H[0],W=H[1],J=Object(r.useState)(!1),K=Object(o.a)(J,2),Q=K[0],Y=K[1],X=Object(C.a)("common").t,Z=Object(A.h)().pathname,$=Object(r.useRef)();$.current=D;var ee=Object(r.useRef)();ee.current=c;var te=Object(r.useRef)();te.current=Q,Object(r.useEffect)((function(){if(U(d?null:(new O.a.ObjectId).toHexString()),d){var e,t=Object(A.f)(Z,{path:"/instructor-panel/course/:courseId/lesson/:lessonId/edit",exact:!1});t&&(e=t.params.lessonId,P(e,S))}return window.addEventListener("beforeunload",(function(){return B(ee.current.values,$.current,te.current,S,y)})),function(){window.removeEventListener("beforeunload",B),k(),Q||Object(L.a)(ee.current.values,$.current,te.current,S,y,"lessonForm")}}),[]),Object(r.useEffect)((function(){if(w){var e=Object(j.a)(w,"lessonForm");N(e)}}),[w]);var ne={label:X("lessonForm.fields.publish"),checked:!1},ae=(c.values||{}).createdAt;return u._id?i.a.createElement(p.a,null,i.a.createElement("div",{style:{paddingTop:"20px"}},i.a.createElement(h.a,{paragraph:!0,variant:"h4",gutterBottom:!0},X("lessonForm.lessonCustomization")),i.a.createElement(l.a,{className:x.a.center,name:"lessonName",type:"text",component:b.a,label:X("lessonForm.fields.lessonName")}),i.a.createElement(l.a,{name:"published",options:ne,component:E.a}),i.a.createElement(l.a,{name:"availableOnDate",type:"dateTime",handleChange:function(e){return m("availableOnDate",e)},component:F.a,fullWidth:!0,options:{disablePast:!0,label:X("lessonForm.fields.availableOnDate"),minDate:ae}})),i.a.createElement(s.a,{formValues:c.values,name:"slides",component:z,course:u,formErrors:f,touchField:v,t:X,editing:d,newLessonId:M,changeField:m,getAudioRecording:function(e,t){return((e.slides||[])[t]||{}).recording},getAudioSource:function(e,t){return((e.slides||[])[t]||{}).recordedBlob},setAudioData:function(e,t,n){m("slides.".concat(n,".recording"),!1),m("slides.".concat(n,".recordedBlob"),e),m("slides.".concat(n,".audioFile"),t)},initiateRecording:function(e,t,n){m("slides.".concat(n,".recording"),!0),m("slides.".concat(n,".recorder"),e),m("slides.".concat(n,".recordingTimeout"),t)},getRecorderFromClick:function(e,t){return((e.slides||[])[t]||{}).recorder||{}},getRecordingTimeout:function(e,t){return((e.slides||[])[t]||{}).recordingTimeout}}),!G&&!f.isValid&&i.a.createElement(h.a,{style:{textAlign:"center",marginBottom:"20px"},gutterBottom:!0,color:"error"},X("lessonForm.errors.correctForm")),i.a.createElement(g.a,{isError:!(G||f.isValid),disabled:t,clicked:function(){if(function(){if(((c.values||{}).slides||[]).forEach((function(e,t){v("slides.".concat(t,".slideContent")),v("slides.".concat(t,".videoFile")),v("slides.".concat(t,".audioFile"))})),v("availableOnDate"),v("lessonName"),f.isValid)return!0}()){var e=Object(j.a)(c.values,"lessonForm"),t=(D||[]).filter((function(t){return e.includes(t)?null:t}));Y(!0),_(d?c.values:Object(a.a)(Object(a.a)({},c.values),{},{_id:M}),S,d,u._id,t)}else W(!1)}},X(d?"lessonForm.buttons.update":"lessonForm.buttons.publish"))):null}));t.default=Object(m.b)((function(e,t){var n=e.common.selectedCourse,o=e.common.courses,r=Object(_.a)(o,n)||{},i=r.lessons||[],l=t.editing,s=e.common.configuration.instructorFileSizeLimit;return{formErrors:Object(c.a)("lessonForm")(e),loading:e.instructorLesson.loading,token:e.authentication.token,formValues:e.form.lessonForm,initialValues:Object(a.a)(Object(a.a)({},e.instructorLesson.loadedLessonFormData),{},{instructorFileSizeLimit:s,lessons:i,course:r,slides:l&&e.instructorLesson.loadedLessonFormData?e.instructorLesson.loadedLessonFormData.slides:[{}],published:!l||(e.instructorLesson.loadedLessonFormData||{}).published}),editing:l,course:r}}),(function(e){return{addNewLesson:function(t,n,a,o,r){e(w.B(t,n,a,o,r))},changeField:function(t,n){return e(Object(d.a)("lessonForm",t,n))},touchField:function(t){e(Object(d.d)("lessonForm",t))},clearLessonForm:function(){return e(w.q())},deleteImg:function(t,n){e(w.Q(t),n)},fetchLesson:function(t,n){e(w.Gb(t,n))}}}))(M)},825:function(e,t,n){"use strict";n.d(t,"d",(function(){return f})),n.d(t,"c",(function(){return v})),n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return b}));var a=n(6),o=n.n(a),r=n(62),i=n(41),l=n(915),s=n.n(l),c=n(458),d=n(916),u=n.n(d),m=function(){var e=Object(i.a)(o.a.mark((function e(t,n,a,i){var l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("saving"),l=new s.a({bitRate:128}),(i||{}).lameEncoder&&(l=i),(t||{}).lameEncoder&&(l=t),console.log("is recorder: ",l),!l){e.next=9;break}return e.next=8,l.stop().getMp3().then((function(e){var t=Object(r.a)(e,2),o=t[0],i=t[1];return{blob:URL.createObjectURL(i),file:new File(o,n?"".concat(a,"-[").concat(n,"]recording.mp3"):"".concat(a,"-recording.mp3"),{type:i.type,lastModified:Date.now()}),index:a}}));case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t,n,a,o){return e.apply(this,arguments)}}(),f=function(e,t,n,a,o){if(e){e.preventDefault();var r=m(null,t,n,o);return clearTimeout(a),r}},v=function(){var e=Object(i.a)(o.a.mark((function e(t,n,a,r,i){var l,d,u,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=new s.a({bitRate:128}),t){e.next=3;break}return e.abrupt("return");case 3:return t.preventDefault(),e.prev=4,e.next=7,l.start();case 7:return d=c.store.getState(),u=d.common.configuration.voiceRecordTimeLimit||60,f=setTimeout((function(){var e=m(l,n,a);i(e)}),1e3*u),e.abrupt("return",{recordingTimeout:f,isRecording:!0,recorder:l,index:a});case 13:return e.prev=13,e.t0=e.catch(4),e.abrupt("return",{isRecording:!1});case 16:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t,n,a,o,r){return e.apply(this,arguments)}}(),p=function(e){var t=document.getElementById(e);t&&t.play()},b=function(){var e=Object(i.a)(o.a.mark((function e(t,n){var a,r,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:a=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log("e: ",e.t0);case 9:return r=u()(a,{type:"video",mimeType:"video/webm;codecs=h264",canvas:{width:640,height:480}}),t({recorder:r,stream:a}),r.startRecording(),l=function(e){return new Promise((function(t){return setTimeout(t,e)}))},6e4,e.next=16,l(6e4);case 16:r.stopRecording(Object(i.a)(o.a.mark((function e(){var i,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=r.getBlob(),l=new File([i],"video-recording.webm",{type:"video/webm"}),n(l),t({recorder:null,stream:null}),a.stop();case 5:case"end":return e.stop()}}),e)}))));case 17:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}()},830:function(e,t,n){"use strict";var a=n(0),o=n.n(a),r=n(882),i=n.n(r);t.a=function(e){var t=e.url,n=e.play,a=e.ended,r=e.pause,l=e.playAutomatically,s=e.muted;return o.a.createElement("div",{style:{width:"100%"}},o.a.createElement(i.a,{playing:l,onPlay:n,onEnded:a,onPause:r,controls:!0,width:"100%",height:"100%",url:t,muted:s}))}},851:function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return b})),n.d(t,"a",(function(){return E}));var a=n(0),o=n.n(a),r=n(245),i=n(863),l=n.n(i),s=n(864),c=n.n(s),d=n(852),u=n.n(d),m=n(39),f=n(107),v=n(428),p=function(e){var t=e.onPreview,n=e.audioSource,a=e.id,i=e.previewType,l=e.previewText,s=e.disabled,c=e.fullWidth,d=Object(v.a)().t;return o.a.createElement(m.a,null,"button"===i?o.a.createElement(m.a,null,o.a.createElement("audio",{id:a,src:n}),o.a.createElement("div",{style:{display:"flex",justifyContent:"space-around"}},o.a.createElement(r.a,{fullWidth:c,onClick:t,color:"primary",disabled:!n||""===n||s},l||d("audioRecorder.buttons.preview")))):o.a.createElement("div",{className:u.a.AudioAlignment},o.a.createElement("audio",{id:a,src:n}),o.a.createElement("span",{className:u.a.Pointer,onClick:t},o.a.createElement("i",{className:"fa fa-volume-down fa-2x ".concat(n?u.a.greenIcon:u.a.redIcon)}))))},b=function(e){var t=e.onClear,n=e.clearDisabled,a=Object(v.a)().t;return o.a.createElement("div",{className:u.a.flexPositioningEven},o.a.createElement(r.a,{color:"secondary",onClick:t,disabled:n},a("audioRecorder.buttons.clearAudio")))},E=function(e){var t=e.onStart,n=e.onStop,a=e.onPreview,i=e.recordDisabled,s=e.audioSource,d=e.id,E=e.meta,F=void 0===E?{}:E,g=e.error,h=e.onClear,y=e.clearDisabled,x=e.recordButtonText,w=e.previewType,O=e.isMicAlert,j=Object(v.a)().t;return o.a.createElement(m.a,null,"button"===w&&o.a.createElement("div",{className:u.a.flexPositioningEven},o.a.createElement(r.a,{onClick:t,disabled:i||O,startIcon:o.a.createElement(l.a,null),color:"primary"},x||j("audioRecorder.buttons.record"))),o.a.createElement("div",{style:{margin:"auto",display:"block",width:"60%"}},O&&o.a.createElement(f.a,{style:{textAlign:"center"},variant:"caption",color:"error"},j("audioRecorder.errors.micBlocked"))),o.a.createElement("div",{className:u.a.flexPositioningEven},"button"!==w&&o.a.createElement(r.a,{onClick:t,disabled:i||O,startIcon:o.a.createElement(l.a,null)},x||j("audioRecorder.buttons.record")),o.a.createElement(r.a,{onClick:n,disabled:!i||O,startIcon:o.a.createElement(c.a,null)},j("audioRecorder.buttons.stop")),o.a.createElement(p,{onPreview:s?a:null,audioSource:s,id:d,previewType:w})),o.a.createElement("div",{className:u.a.flexPositioningEven},o.a.createElement("span",{className:u.a.errorText},(F.error||g)&&F.touched?F.error||g:""," ")),o.a.createElement("div",{className:u.a.flexPositioningEven},o.a.createElement(b,{onClear:h,clearDisabled:y})))}},852:function(e,t,n){e.exports={greenIcon:"AudioPlayer_greenIcon__knaj_",redIcon:"AudioPlayer_redIcon__VtpzN",flexPositioningEven:"AudioPlayer_flexPositioningEven__mBu5R",AudioAlignment:"AudioPlayer_AudioAlignment__1RjTd",Pointer:"AudioPlayer_Pointer__3IoHf",errorText:"AudioPlayer_errorText__1KeLa",advancedAudioPlayer:"AudioPlayer_advancedAudioPlayer__2hxRe","audio-player":"AudioPlayer_audio-player__q667P"}},863:function(e,t,n){"use strict";var a=n(92);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(0)),r=(0,a(n(108)).default)(o.default.createElement("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"}),"Mic");t.default=r},864:function(e,t,n){"use strict";var a=n(92);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(0)),r=(0,a(n(108)).default)(o.default.createElement("path",{d:"M6 6h12v12H6z"}),"Stop");t.default=r}}]);
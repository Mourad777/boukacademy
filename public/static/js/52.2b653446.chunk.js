(this["webpackJsonpe-learn"]=this["webpackJsonpe-learn"]||[]).push([[52],{1335:function(e,n,t){"use strict";t.r(n);var o=t(30),a=t(0),r=t.n(a),u=t(31),s=t(4),c=t(38),i=t(148),l=t(154),f=t.n(l),d=t(83),p=t(244);n.default=Object(u.b)((function(e){return{token:e.authentication.token,userId:e.authentication.userId,loading:e.studentCourse.loading||e.studentTest.loading||e.common.loading,notification:e.common.notification,tab:e.common.tab,course:e.common.selectedCourse,courses:e.common.courses,testInSession:e.studentTest.testInSession}}),(function(e){return{fetchCourses:function(n,t){return e(s.yb(n,t))},fetchTestResults:function(n,t){return e(s.Xb(n,t))},fetchNotifications:function(n,t){return e(s.Nb(n,t))},fetchStudents:function(n,t,o){return e(s.Tb(n,t,null,o))},fetchModules:function(n,t,o){return e(s.Kb(n,t,o))},fetchUser:function(n,t){return e(s.fc(n,t))},setNotification:function(n,t){return e(s.ad(n,t))},fetchCryptoCharges:function(n){return e(s.Bb(n))},fetchTransactions:function(n){return e(s.cc(n))},logout:function(n){e(s.rc(n))},fetchConfig:function(n,t){return e(s.sb(n,t))},clearTestSessionData:function(){return e(s.Oc())}}}))((function(e){var n=e.fetchTestResults,t=e.loading,u=e.fetchCourses,s=e.fetchNotifications,l=e.fetchConfig,b=e.testInSession,h=e.fetchStudents,m=e.fetchUser,D=e.fetchModules,S=e.clearTestSessionData,I=e.fetchCryptoCharges,g=e.fetchTransactions,w=e.course,v=e.courses,y=e.logout,T=Object(d.g)();return Object(a.useEffect)((function(){var e=localStorage.getItem("token"),t=localStorage.getItem("userId"),a=f()("https://www.boukacademy.com/",{query:{token:e}}),r=function(){a.emit("loggedOut",{user:t})};window.addEventListener("beforeunload",r),a.open(),a.on("updateCourses",(function(n){"student"!==n.userType&&"all"!==n.userType&&n.userId!==t||(u(e,"noSpinner"),s(e,"noSpinner"))})),a.on("updateResults",(function(o){"student"!==o.userType&&o.userId!==t||(n(e,"noSpinner"),s(e,"noSpinner"))})),a.on("cryptoChargeEvent",(function(n){var o=n.event;n.userId===t&&(I(e),g(e),console.log("event",o),console.log("body",n.body))})),a.emit("loggedIn",{user:t}),a.on("mainMenu",(function(n){n.userId!==t&&"student"!==n.userType||!b||(s(e,"noSpinner"),u(e,"noSpinner"),S(),w?T.push("/student-panel/courses/".concat(w,"/modules")):T.push("/student-panel/course"))})),a.on("activateAccount",(function(o){o.userId===t&&(m(e,"noSpinner"),l(e,"noSpinner"),s(e,"noSpinner"),u(e,"noSpinner"),n(e,"noSpinner"))})),a.on("suspendAccount",(function(e){e.userId===t&&y(T)})),a.on("alert",(function(n){s(e,"noSpinner")})),a.on("updateStudents",(function(n){w&&("all"!==n.userType&&"student"!==n.userType||n.courseId!==w||(h(w,e,"noSpinner"),s(e,"noSpinner")))})),a.on("updateModules",(function(n){w&&"student"===n.userType&&D(w,e,"noSpinner")})),a.on("updateConfig",(function(n){"all"!==n.userType&&n.courseId!==w||l(e,"noSpinner")}));var c=Object(p.a)(v,w),i=(c.lessons||[]).filter((function(e){return e.availableOnDate&&Date.now()<parseInt(e.availableOnDate)})).map((function(e){return parseInt(e.availableOnDate)})),d=(c.tests||[]).filter((function(e){return e.availableOnDate&&Date.now()<parseInt(e.availableOnDate)})).map((function(e){return parseInt(e.availableOnDate)})),O=(c.tests||[]).filter((function(e){return e.dueDate&&Date.now()<parseInt(e.dueDate)&&!e.allowLateSubmission})).map((function(e){return parseInt(e.dueDate)})),C=[];(c.tests||[]).forEach((function(e){if(e.allowLateSubmission&&Date.now()<parseInt(e.dueDate)+864e5*e.lateDaysAllowed)for(var n=parseInt(e.dueDate);n<parseInt(e.dueDate)+864e5*e.lateDaysAllowed;n+=864e5)n>Date.now()&&C.push(n)}));var j,E=(c.tests||[]).filter((function(e){return Date.now()<parseInt(e.dueDate)+864e5*e.lateDaysAllowed&&e.allowLateSubmission})).map((function(e){return parseInt(e.dueDate)+864e5*e.lateDaysAllowed})),k=(c.tests||[]).filter((function(e){return e.gradeReleaseDate&&Date.now()<parseInt(e.gradeReleaseDate)})).map((function(e){return parseInt(e.gradeReleaseDate)})),A=[];return[].concat(Object(o.a)(i),Object(o.a)(d),Object(o.a)(O),Object(o.a)(E),C,Object(o.a)(k)).forEach((function(t){j=setTimeout((function(){A.push(j),u(e,"noSpinner"),n(e,"noSpinner")}),t-Date.now())})),function(){A.forEach((function(e){clearTimeout(e)})),a.emit("loggedOut",{user:t}),window.removeEventListener("beforeunload",r),a.disconnect()}}),[w,v,b]),r.a.createElement(c.a,null,r.a.createElement(i.a,{active:t,transparent:!0}))}))}}]);
(this["webpackJsonpe-learn"]=this["webpackJsonpe-learn"]||[]).push([[51],{1333:function(e,n,t){"use strict";t.r(n);var o=t(30),a=t(0),u=t.n(a),r=t(31),s=t(4),c=t(39),i=t(149),l=t(113),f=t.n(l),d=t(82),p=t(246);n.default=Object(r.b)((function(e){return{token:e.authentication.token,userId:e.authentication.userId,loading:e.studentCourse.loading||e.studentTest.loading||e.common.loading,notification:e.common.notification,tab:e.common.tab,course:e.common.selectedCourse,courses:e.common.courses,testInSession:e.studentTest.testInSession}}),(function(e){return{fetchCourses:function(n,t){return e(s.xb(n,t))},fetchTestResults:function(n,t){return e(s.Wb(n,t))},fetchNotifications:function(n,t){return e(s.Mb(n,t))},fetchStudents:function(n,t,o){return e(s.Sb(n,t,null,o))},fetchModules:function(n,t,o){return e(s.Jb(n,t,o))},fetchUser:function(n,t){return e(s.ec(n,t))},fetchTransactions:function(n){return e(s.bc(n))},closeModal:function(){e(s.t())},logout:function(n){e(s.qc(n))},fetchConfig:function(n,t){return e(s.rb(n,t))},clearTestSessionData:function(){return e(s.Nc())}}}))((function(e){var n=e.fetchTestResults,t=e.loading,r=e.fetchCourses,s=e.fetchNotifications,l=e.fetchConfig,b=e.testInSession,m=e.fetchStudents,h=e.fetchUser,S=e.fetchModules,D=e.clearTestSessionData,I=e.fetchTransactions,g=e.course,w=e.courses,v=e.closeModal,y=e.logout,T=Object(d.g)();return Object(a.useEffect)((function(){var e=localStorage.getItem("token"),t=localStorage.getItem("userId"),a=f()("https://www.boukacademy.com/",{query:{token:e}}),u=function(){a.emit("loggedOut",{user:t})};window.addEventListener("beforeunload",u),a.open(),a.on("updateCourses",(function(n){"student"!==n.userType&&"all"!==n.userType&&n.userId!==t||(r(e,"noSpinner"),s(e,"noSpinner"))})),a.on("updateResults",(function(o){"student"!==o.userType&&o.userId!==t||(n(e,"noSpinner"),s(e,"noSpinner"))})),a.on("cryptoChargeEvent",(function(n){var o=n.event;n.userId===t&&(I(e),"charge:confirmed"!==o.type&&"charge:delayed"!==o.type||(v(),r(e)))})),a.emit("loggedIn",{user:t}),a.on("mainMenu",(function(n){n.userId!==t&&"student"!==n.userType||!b||(s(e,"noSpinner"),r(e,"noSpinner"),D(),g?T.push("/student-panel/courses/".concat(g,"/modules")):T.push("/student-panel/course"))})),a.on("activateAccount",(function(o){o.userId===t&&(h(e,"noSpinner"),l(e,"noSpinner"),s(e,"noSpinner"),r(e,"noSpinner"),n(e,"noSpinner"))})),a.on("suspendAccount",(function(e){e.userId===t&&y(T)})),a.on("alert",(function(n){s(e,"noSpinner")})),a.on("updateStudents",(function(n){g&&("all"!==n.userType&&"student"!==n.userType||n.courseId!==g||(m(g,e,"noSpinner"),s(e,"noSpinner")))})),a.on("updateModules",(function(n){g&&"student"===n.userType&&S(g,e,"noSpinner")})),a.on("updateConfig",(function(n){"all"!==n.userType&&n.courseId!==g||l(e,"noSpinner")}));var c=Object(p.a)(w,g),i=(c.lessons||[]).filter((function(e){return e.availableOnDate&&Date.now()<parseInt(e.availableOnDate)})).map((function(e){return parseInt(e.availableOnDate)})),d=(c.tests||[]).filter((function(e){return e.availableOnDate&&Date.now()<parseInt(e.availableOnDate)})).map((function(e){return parseInt(e.availableOnDate)})),O=(c.tests||[]).filter((function(e){return e.dueDate&&Date.now()<parseInt(e.dueDate)&&!e.allowLateSubmission})).map((function(e){return parseInt(e.dueDate)})),j=[];(c.tests||[]).forEach((function(e){if(e.allowLateSubmission&&Date.now()<parseInt(e.dueDate)+864e5*e.lateDaysAllowed)for(var n=parseInt(e.dueDate);n<parseInt(e.dueDate)+864e5*e.lateDaysAllowed;n+=864e5)n>Date.now()&&j.push(n)}));var C,E=(c.tests||[]).filter((function(e){return Date.now()<parseInt(e.dueDate)+864e5*e.lateDaysAllowed&&e.allowLateSubmission})).map((function(e){return parseInt(e.dueDate)+864e5*e.lateDaysAllowed})),k=(c.tests||[]).filter((function(e){return e.gradeReleaseDate&&Date.now()<parseInt(e.gradeReleaseDate)})).map((function(e){return parseInt(e.gradeReleaseDate)})),M=[];return[].concat(Object(o.a)(i),Object(o.a)(d),Object(o.a)(O),Object(o.a)(E),j,Object(o.a)(k)).forEach((function(t){C=setTimeout((function(){M.push(C),r(e,"noSpinner"),n(e,"noSpinner")}),t-Date.now())})),function(){M.forEach((function(e){clearTimeout(e)})),a.emit("loggedOut",{user:t}),window.removeEventListener("beforeunload",u),a.disconnect()}}),[g,w,b]),u.a.createElement(c.a,null,u.a.createElement(i.a,{active:t,transparent:!0}))}))}}]);
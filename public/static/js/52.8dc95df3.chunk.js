(this["webpackJsonpe-learn"]=this["webpackJsonpe-learn"]||[]).push([[52],{1323:function(e,n,t){"use strict";t.r(n);var o=t(30),a=t(0),u=t.n(a),r=t(31),s=t(4),i=t(38),c=t(148),l=t(154),f=t.n(l),d=t(83),p=t(244);n.default=Object(r.b)((function(e){return{token:e.authentication.token,userId:e.authentication.userId,loading:e.studentCourse.loading||e.studentTest.loading||e.common.loading,notification:e.common.notification,tab:e.common.tab,course:e.common.selectedCourse,courses:e.common.courses,testInSession:e.studentTest.testInSession}}),(function(e){return{fetchCourses:function(n,t){return e(s.yb(n,t))},fetchTestResults:function(n,t){return e(s.Xb(n,t))},fetchNotifications:function(n,t){return e(s.Nb(n,t))},fetchStudents:function(n,t,o){return e(s.Tb(n,t,null,o))},fetchModules:function(n,t,o){return e(s.Kb(n,t,o))},fetchUser:function(n,t){return e(s.fc(n,t))},setNotification:function(n,t){return e(s.ad(n,t))},fetchCryptoCharges:function(n){return e(s.Bb(n))},logout:function(n){e(s.rc(n))},fetchConfig:function(n,t){return e(s.sb(n,t))},clearTestSessionData:function(){return e(s.Oc())}}}))((function(e){var n=e.fetchTestResults,t=e.loading,r=e.fetchCourses,s=e.fetchNotifications,l=e.fetchConfig,b=e.testInSession,h=e.fetchStudents,m=e.fetchUser,D=e.fetchModules,S=e.clearTestSessionData,I=e.fetchCryptoCharges,g=e.course,w=e.courses,v=e.logout,y=Object(d.g)();return Object(a.useEffect)((function(){var e=localStorage.getItem("token"),t=localStorage.getItem("userId"),a=f()("https://www.boukacademy.com/",{query:{token:e}}),u=function(){a.emit("loggedOut",{user:t})};window.addEventListener("beforeunload",u),a.open(),a.on("updateCourses",(function(n){"student"!==n.userType&&"all"!==n.userType&&n.userId!==t||(r(e,"noSpinner"),s(e,"noSpinner"))})),a.on("updateResults",(function(o){"student"!==o.userType&&o.userId!==t||(n(e,"noSpinner"),s(e,"noSpinner"))})),a.on("cryptoChargeEvent",(function(n){var o=n.event;n.userId===t&&(I(e),console.log("event",o),console.log("body",n.body))})),a.emit("loggedIn",{user:t}),a.on("mainMenu",(function(n){n.userId!==t&&"student"!==n.userType||!b||(s(e,"noSpinner"),r(e,"noSpinner"),S(),g?y.push("/student-panel/courses/".concat(g,"/modules")):y.push("/student-panel/course"))})),a.on("activateAccount",(function(o){o.userId===t&&(m(e,"noSpinner"),l(e,"noSpinner"),s(e,"noSpinner"),r(e,"noSpinner"),n(e,"noSpinner"))})),a.on("suspendAccount",(function(e){e.userId===t&&v(y)})),a.on("alert",(function(n){s(e,"noSpinner")})),a.on("updateStudents",(function(n){g&&("all"!==n.userType&&"student"!==n.userType||n.courseId!==g||(h(g,e,"noSpinner"),s(e,"noSpinner")))})),a.on("updateModules",(function(n){g&&"student"===n.userType&&D(g,e,"noSpinner")})),a.on("updateConfig",(function(n){"all"!==n.userType&&n.courseId!==g||l(e,"noSpinner")}));var i=Object(p.a)(w,g),c=(i.lessons||[]).filter((function(e){return e.availableOnDate&&Date.now()<parseInt(e.availableOnDate)})).map((function(e){return parseInt(e.availableOnDate)})),d=(i.tests||[]).filter((function(e){return e.availableOnDate&&Date.now()<parseInt(e.availableOnDate)})).map((function(e){return parseInt(e.availableOnDate)})),O=(i.tests||[]).filter((function(e){return e.dueDate&&Date.now()<parseInt(e.dueDate)&&!e.allowLateSubmission})).map((function(e){return parseInt(e.dueDate)})),T=[];(i.tests||[]).forEach((function(e){if(e.allowLateSubmission&&Date.now()<parseInt(e.dueDate)+864e5*e.lateDaysAllowed)for(var n=parseInt(e.dueDate);n<parseInt(e.dueDate)+864e5*e.lateDaysAllowed;n+=864e5)n>Date.now()&&T.push(n)}));var C,j=(i.tests||[]).filter((function(e){return Date.now()<parseInt(e.dueDate)+864e5*e.lateDaysAllowed&&e.allowLateSubmission})).map((function(e){return parseInt(e.dueDate)+864e5*e.lateDaysAllowed})),E=(i.tests||[]).filter((function(e){return e.gradeReleaseDate&&Date.now()<parseInt(e.gradeReleaseDate)})).map((function(e){return parseInt(e.gradeReleaseDate)})),k=[];return[].concat(Object(o.a)(c),Object(o.a)(d),Object(o.a)(O),Object(o.a)(j),T,Object(o.a)(E)).forEach((function(t){C=setTimeout((function(){k.push(C),r(e,"noSpinner"),n(e,"noSpinner")}),t-Date.now())})),function(){k.forEach((function(e){clearTimeout(e)})),a.emit("loggedOut",{user:t}),window.removeEventListener("beforeunload",u),a.disconnect()}}),[g,w,b]),u.a.createElement(i.a,null,u.a.createElement(c.a,{active:t,transparent:!0}))}))}}]);